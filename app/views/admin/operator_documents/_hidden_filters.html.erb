<style>
  li[aria-disabled='true'] {
    display: none;
  }
</style>
<script>
  const filters = <%= raw(filter.to_json) %>;

  Object.keys(filters).forEach(key => {
    $(`#${key}`).on('change', onFilterChange.bind(null, key));
  });

  function onFilterChange(filterKey, e) {
    const id = e.target.value;

    Object.keys(filters[filterKey]).forEach(key => {
      const allowedIds = filters[filterKey][key][id];
      const $select = $(`#${key}`);
      Array.from($select.select2()[0].options).forEach(option => {
        if(id === "") {
          $(option).prop('disabled', false);
        } else {
          if (allowedIds == undefined || !allowedIds.includes(parseInt(option.value))) {
            $(option).prop('disabled',true);
          } else {
            $(option).prop('disabled',false);
          }
        }
      });
      $select.val("");
      $select.trigger('change');
    });
  }
</script>
